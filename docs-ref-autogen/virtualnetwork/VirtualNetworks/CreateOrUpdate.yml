### YamlMime:RESTOperation
summary: Creates or updates a virtual network in the specified resource group.
service: Virtual Networks
apiVersion: 2017-10-01
groupName: Virtual Networks
consumes:
- application/json
- text/json
produces:
- application/json
- text/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}?api-version=2017-10-01
uriParameters:
- in: path
  isRequired: true
  description: The subscription credentials which uniquely identify the Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
  name: subscriptionId
- in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
  name: resourceGroupName
- in: path
  isRequired: true
  description: The name of the virtual network.
  types:
  - uid: string
  name: virtualNetworkName
- in: query
  isRequired: true
  description: Client API version.
  types:
  - uid: string
  name: api-version
responses:
- description: Update successful. The operation returns the resulting VirtualNetwork resource.
  types:
  - uid: VirtualNetwork
  name: 200 OK
- description: Create successful. The operation returns the resulting VirtualNetwork resource.
  types:
  - uid: VirtualNetwork
  name: 201 Created
requestBody:
- parameters:
  - in: body
    description: Gets a unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
    name: etag
  - in: body
    description: The AddressSpace that contains an array of IP address ranges that can be used by subnets.
    types:
    - uid: AddressSpace
    name: properties.addressSpace
  - in: body
    description: The dhcpOptions that contains an array of DNS servers available to VMs deployed in the virtual network.
    types:
    - uid: DhcpOptions
    name: properties.dhcpOptions
  - in: body
    description: Subnet in a virtual network resource.
    types:
    - isArray: true
      uid: Subnet
    name: properties.subnets
  - in: body
    description: Peerings in a virtual network resource.
    types:
    - isArray: true
      uid: VirtualNetworkPeering
    name: properties.virtualNetworkPeerings
  - in: body
    description: The resourceGuid property of the Virtual Network resource.
    types:
    - uid: string
    name: properties.resourceGuid
  - in: body
    description: "The provisioning state of the PublicIP resource. Possible values are: 'Updating', 'Deleting', and 'Failed'."
    types:
    - uid: string
    name: properties.provisioningState
  - in: body
    description: Indicates if DDoS protection is enabled for all the protected resources in a Virtual Network.
    types:
    - uid: boolean
    name: properties.enableDdosProtection
  - in: body
    description: Indicates if Vm protection is enabled for all the subnets in a Virtual Network.
    types:
    - uid: boolean
    name: properties.enableVmProtection
  - in: body
    description: Resource location.
    types:
    - uid: string
    name: location
  - in: body
    description: Resource tags.
    types:
    - isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
      uid: object
    name: tags
requestHeader: []
definitions:
- name: AddressSpace
  description: The reference of the remote virtual network address space.
  kind: object
  properties:
  - description: A list of address blocks reserved for this virtual network in CIDR notation.
    types:
    - isArray: true
      uid: string
    name: addressPrefixes
- name: DhcpOptions
  description: The dhcpOptions that contains an array of DNS servers available to VMs deployed in the virtual network.
  kind: object
  properties:
  - description: The list of DNS servers IP addresses.
    types:
    - isArray: true
      uid: string
    name: dnsServers
- name: Subnet
  description: Subnet in a virtual network resource.
  kind: object
  properties:
  - description: The name of the resource that is unique within a resource group. This name can be used to access the resource.
    types:
    - uid: string
    name: name
  - description: A unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
    name: etag
  - description: The address prefix for the subnet.
    types:
    - uid: string
    name: properties.addressPrefix
  - description: The reference of the NetworkSecurityGroup resource.
    types:
    - uid: SubResource
    name: properties.networkSecurityGroup
  - description: The reference of the RouteTable resource.
    types:
    - uid: SubResource
    name: properties.routeTable
  - description: The service endpoint properties.
    types:
    - isArray: true
      uid: ServiceEndpointPropertiesFormat
    name: properties.serviceEndpoints
  - isReadyOnly: true
    description: Reference to another subresource.
    types:
    - isArray: true
      uid: SubResource
    name: properties.ipConfigurations
  - description: ResourceNavigationLink resource.
    types:
    - isArray: true
      uid: ResourceNavigationLink
    name: properties.resourceNavigationLinks
  - description: The provisioning state of the resource.
    types:
    - uid: string
    name: properties.provisioningState
  - isReadyOnly: true
    description: Resource ID
    types:
    - uid: string
    name: id
- name: VirtualNetworkPeering
  description: Peerings in a virtual network resource.
  kind: object
  properties:
  - description: The name of the resource that is unique within a resource group. This name can be used to access the resource.
    types:
    - uid: string
    name: name
  - description: A unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
    name: etag
  - description: Whether the VMs in the linked virtual network space would be able to access all the VMs in local Virtual network space.
    types:
    - uid: boolean
    name: properties.allowVirtualNetworkAccess
  - description: Whether the forwarded traffic from the VMs in the remote virtual network will be allowed/disallowed.
    types:
    - uid: boolean
    name: properties.allowForwardedTraffic
  - description: If gateway links can be used in remote virtual networking to link to this virtual network.
    types:
    - uid: boolean
    name: properties.allowGatewayTransit
  - description: If remote gateways can be used on this virtual network. If the flag is set to true, and allowGatewayTransit on remote peering is also true, virtual network will use gateways of remote virtual network for transit. Only one peering can have this flag set to true. This flag cannot be set if virtual network already has a gateway.
    types:
    - uid: boolean
    name: properties.useRemoteGateways
  - description: The reference of the remote virtual network. The remote virtual network can be in the same or different region (preview). See here to register for the preview and learn more (https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-create-peering).
    types:
    - uid: SubResource
    name: properties.remoteVirtualNetwork
  - description: The reference of the remote virtual network address space.
    types:
    - uid: AddressSpace
    name: properties.remoteAddressSpace
  - description: The status of the virtual network peering. Possible values are 'Initiated', 'Connected', and 'Disconnected'.
    types:
    - uid: VirtualNetworkPeeringState
    name: properties.peeringState
  - description: The provisioning state of the resource.
    types:
    - uid: string
    name: properties.provisioningState
  - isReadyOnly: true
    description: Resource ID
    types:
    - uid: string
    name: id
- name: VirtualNetwork
  description: Virtual Network resource.
  kind: object
  properties:
  - description: Gets a unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
    name: etag
  - description: The AddressSpace that contains an array of IP address ranges that can be used by subnets.
    types:
    - uid: AddressSpace
    name: properties.addressSpace
  - description: The dhcpOptions that contains an array of DNS servers available to VMs deployed in the virtual network.
    types:
    - uid: DhcpOptions
    name: properties.dhcpOptions
  - description: Subnet in a virtual network resource.
    types:
    - isArray: true
      uid: Subnet
    name: properties.subnets
  - description: Peerings in a virtual network resource.
    types:
    - isArray: true
      uid: VirtualNetworkPeering
    name: properties.virtualNetworkPeerings
  - description: The resourceGuid property of the Virtual Network resource.
    types:
    - uid: string
    name: properties.resourceGuid
  - description: "The provisioning state of the PublicIP resource. Possible values are: 'Updating', 'Deleting', and 'Failed'."
    types:
    - uid: string
    name: properties.provisioningState
  - description: Indicates if DDoS protection is enabled for all the protected resources in a Virtual Network.
    types:
    - uid: boolean
    name: properties.enableDdosProtection
  - description: Indicates if Vm protection is enabled for all the subnets in a Virtual Network.
    types:
    - uid: boolean
    name: properties.enableVmProtection
  - isReadyOnly: true
    description: Resource ID.
    types:
    - uid: string
    name: id
  - isReadyOnly: true
    description: Resource name.
    types:
    - uid: string
    name: name
  - isReadyOnly: true
    description: Resource type.
    types:
    - uid: string
    name: type
  - description: Resource location.
    types:
    - uid: string
    name: location
  - description: Resource tags.
    types:
    - isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
      uid: object
    name: tags
- name: SubResource
  description: The reference of the NetworkSecurityGroup resource.
  kind: object
  properties:
  - description: Resource ID.
    types:
    - uid: string
    name: id
- name: ServiceEndpointPropertiesFormat
  description: An array of service endpoints.
  kind: object
  properties:
  - description: The type of the endpoint service.
    types:
    - uid: string
    name: service
  - description: A list of locations.
    types:
    - isArray: true
      uid: string
    name: locations
  - description: The provisioning state of the resource.
    types:
    - uid: string
    name: provisioningState
- name: ResourceNavigationLink
  description: ResourceNavigationLink resource.
  kind: object
  properties:
  - description: Name of the resource that is unique within a resource group. This name can be used to access the resource.
    types:
    - uid: string
    name: name
  - isReadyOnly: true
    description: A unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
    name: etag
  - description: Resource type of the linked resource.
    types:
    - uid: string
    name: properties.linkedResourceType
  - description: Link to the external resource
    types:
    - uid: string
    name: properties.link
  - isReadyOnly: true
    description: Provisioning state of the ResourceNavigationLink resource.
    types:
    - uid: string
    name: properties.provisioningState
  - isReadyOnly: true
    description: Resource ID
    types:
    - uid: string
    name: id
- name: VirtualNetworkPeeringState
  description: The status of the virtual network peering. Possible values are 'Initiated', 'Connected', and 'Disconnected'.
  kind: enum
  properties:
  - types:
    - uid: string
    name: Initiated
  - types:
    - uid: string
    name: Connected
  - types:
    - uid: string
    name: Disconnected
examples:
- request:
    uri: PUT https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet?api-version=2017-10-01
    body: >-
      {
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "name": "test-vnet",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [],
          "virtualNetworkPeerings": []
        }
      }
  - statusCode: "201"
    body: >-
      {
        "name": "test-vnet",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [],
          "virtualNetworkPeerings": []
        }
      }
  name: Create virtual network
- request:
    uri: PUT https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet?api-version=2017-10-01
    body: >-
      {
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "name": "test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/24"
              }
            }
          ]
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "name": "test-vnet",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet/subnets/test-1",
              "name": "test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/24",
                "provisioningState": "Succeeded"
              }
            }
          ],
          "virtualNetworkPeerings": []
        }
      }
  - statusCode: "201"
    body: >-
      {
        "name": "test-vnet",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/virtualNetworks/test-vnet/subnets/test-1",
              "name": "test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/24",
                "provisioningState": "Succeeded"
              }
            }
          ],
          "virtualNetworkPeerings": []
        }
      }
  name: Create virtual network with subnet
- request:
    uri: PUT https://management.azure.com/subscriptions/subid/resourceGroups/vnetTest/providers/Microsoft.Network/virtualNetworks/vnet1?api-version=2017-10-01
    body: >-
      {
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "name": "test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/16",
                "serviceEndpoints": [
                  {
                    "service": "Microsoft.Storage"
                  }
                ]
              }
            }
          ]
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "name": "vnet1",
        "id": "/subscriptions/subid/resourceGroups/vnetTest/providers/Microsoft.Network/virtualNetworks/vnet1",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "name": "test-1",
              "id": "/subscriptions/subid/resourceGroups/vnetTest/providers/Microsoft.Network/virtualNetworks/vnet1/subnets/test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/16",
                "ipConfigurations": [],
                "resourceNavigationLinks": [],
                "serviceEndpoints": [
                  {
                    "provisioningState": "Succeeded",
                    "service": "Microsoft.Storage",
                    "locations": [
                      "eastus2(stage)",
                      "usnorth(stage)"
                    ]
                  }
                ],
                "provisioningState": "Succeeded"
              }
            }
          ],
          "virtualNetworkPeerings": []
        }
      }
  - statusCode: "201"
    body: >-
      {
        "name": "vnet1",
        "id": "/subscriptions/subid/resourceGroups/vnetTest/providers/Microsoft.Network/virtualNetworks/vnet1",
        "type": "Microsoft.Network/virtualNetworks",
        "location": "westus",
        "properties": {
          "provisioningState": "Succeeded",
          "addressSpace": {
            "addressPrefixes": [
              "10.0.0.0/16"
            ]
          },
          "subnets": [
            {
              "name": "test-1",
              "id": "/subscriptions/subid/resourceGroups/vnetTest/providers/Microsoft.Network/virtualNetworks/vnet1/subnets/test-1",
              "properties": {
                "addressPrefix": "10.0.0.0/16",
                "ipConfigurations": [],
                "resourceNavigationLinks": [],
                "serviceEndpoints": [
                  {
                    "provisioningState": "Succeeded",
                    "service": "Microsoft.Storage",
                    "locations": [
                      "eastus2(stage)",
                      "usnorth(stage)"
                    ]
                  }
                ],
                "provisioningState": "Succeeded"
              }
            }
          ],
          "virtualNetworkPeerings": []
        }
      }
  name: Create virtual network with service endpoints
security:
- type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - description: impersonate your user account
    name: user_impersonation
name: Create Or Update
uid: management.azure.com.virtualnetworks.virtualnetworks.createorupdate
