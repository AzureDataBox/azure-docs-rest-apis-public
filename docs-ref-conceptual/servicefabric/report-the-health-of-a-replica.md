---
title: "Report the health of a replica"
ms.custom: ""
ms.date: "2017-02-03"
ms.prod: "azure"
ms.reviewer: ""
ms.service: "service-fabric"
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "reference"
applies_to: 
  - "Azure"
  - "Windows 10"
  - "Windows 8"
  - "Windows 8.1"
  - "Windows Server 2012 R2"
dev_langs: 
  - "CSharp"
helpviewer_keywords: 
  - "Service Fabric REST API Reference"
ms.assetid: 777b3bf0-4938-4257-bd8d-67c9c3a5a48d
caps.latest.revision: 13
author: "rwike77"
ms.author: "ryanwi"
manager: "timlt"
translation.priority.mt: 
  - "de-de"
  - "es-es"
  - "fr-fr"
  - "it-it"
  - "ja-jp"
  - "ko-kr"
  - "pt-br"
  - "ru-ru"
  - "zh-cn"
  - "zh-tw"
---
# Report the health of a replica
Reports the health state of the specified Service Fabric replica.  
  
## Request  
 See [Replica](replica.md) for headers and parameters that are used by all requests related to replicas.  
  
|Method|Request URI|  
|------------|-----------------|  
|POST|The following URI is used to send a stateful replica health report:<br /><br /> `<URI>/Applications/{application-name}/$/GetServices/{service-id}/$/GetPartitions/{partition-id}/$/>GetReplicas/{replica-id}/$/ReportHealth?api-version={api-version}`|  
|POST|The following URI is used to send a stateful replica or a stateless instance health report, based on the service kind:<br /><br /> `<URI>/Applications/{application-name}/$/GetServices/{service-id}/$/GetPartitions/{partition-id}/$/>GetReplicas/{replica-id}/$/ReportHealth?api-version={api-version}&ServiceKind={value}`|  
|POST|The following URI is used to send a stateful replica or a stateless instance health report, based on the service kind:<br /><br /> `<URI>/Services/{service-name}/$/GetPartitions/{partition-id}/$/GetReplicas/{replica-id}/$/ReportHealth?api-version={api-version}&ServiceKind={service-kind}`|  
|POST|The following URI is used to send a stateful replica or a stateless instance health report, based on the service kind:<br /><br /> `<URI>/Partitions/{partition-id}/$/GetReplicas/{replica-id}/$/ReportHealth?api-version={api-version}&ServiceKind={service-kind}`|  
  
### URI Parameters  
  
|URI Parameters|Required|Description|  
|--------------------|--------------|-----------------|  
|api-version|Yes|The API Version, which is "1.0”.|  
|service-kind|No|The service kind. If not specified, the default value is stateful. Possible values are:<br /><br /> -   Invalid - Indicates the service kind is invalid. All Service Fabric enumerations have the invalid type. The value is zero.<br />-   Stateless - Does not use Service Fabric to make its state highly available or reliable. The value is 1.<br />-   Stateful - Uses Service Fabric to make its state or part of its state highly available and reliable. The value is 2.|  
  
 POST body  
  
```  
{  
    "SourceId": "RestClient",  
    "Property": "State",  
    "HealthState": 3,  
    "Description": "Sample health state description of replica health.",  
    "TimeToLiveInMilliSeconds": "0",  
    "SequenceNumber": "0",  
    "RemoveWhenExpired": true  
}  
  
```  
  
|Element name|Required|Type|Description|  
|------------------|--------------|----------|-----------------|  
|SourceId|Yes|String|The source ID of the health report.|  
|Property|Yes|String|The property being reported.|  
|HealthState|Yes|HealthState enumerated number|The replica health state. Possible values are:<br /><br /> -   Invalid - Indicates an invalid health state. All Service Fabric enumerations have the invalid type. The value is zero.<br />-   Ok - Indicates the health state is okay. The value is 1.<br />-   Warning - Indicates the health status is at a warning level. The value is 2.<br />-   Indicated the health status is at an error level. The value is 3.<br />-   Unknown - Indicates an unknown health status. The value is 65535.|  
|Description|No|String|The health state description. The maximum string length for the description is 4096 characters.|  
|TimeToLiveInMilliSeconds|No|String|The time for this health report to be valid in milliseconds. If not specified, time to live defaults to infinite value. To explicitly set Infinite time to live, use value “922337203685477”.|  
|SequenceNumber|No|String|The sequence number for this health report as a numeric string. If not specified, a sequence number is auto-generated by the health client.|  
|RemoveWhenExpired|No|Boolean|`true` to remove the health report after the time to live expires; `false` to keep the health event after the time to live expires. If not specified, the default is `false`.|  
  
## Response  
 A successful operation will return 200 OK. For information on error codes, see [Status and Error Codes](status-and-error-codes1.md).  
  
## Examples  
 The following example reports the health of a replica.  
  
```  
  
/// <summary>  
/// Class similar to HealthInformation. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class HealthInformation2  
{  
    public string SourceId { get; set; }  
    public string Property { get; set; }  
    public HealthState HealthState { get; set; }  
    public string Description { get; set; }  
    public string TimeToLiveInMilliSeconds { get; set; }  
    public string SequenceNumber { get; set; }  
    public bool RemoveWhenExpired { get; set; }  
}  
  
/// <summary>  
/// Class similar to DeployedStatefulServiceReplica. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class DeployedStatefulServiceReplica2  
{  
    public ServiceKind ServiceKind;  
    public string ServiceName;  
    public string ServiceTypeName;  
    public string ServiceManifestName;  
    public string CodePackageName;  
    public Guid Partitionid;  
    public string ReplicaId;  
    public ReplicaRole ReplicaRole;  
    public ServiceReplicaStatus ReplicaStatus;  
    public string Address;  
}  
  
/// <summary>  
/// Reports the health of a replica.  
/// </summary>  
/// <remarks>  
/// Gets the list of replicas for WordCount, then reports health of the first replica in the list.  
/// </remarks>  
/// <param name="clusterUri">The URI of the cluster.</param>  
/// <returns>Returns true if successful; otherwise false.</returns>  
public static bool ReportReplicaHealth(Uri clusterUri)  
{  
    // String to capture the response stream.  
    string responseString = string.Empty;  
  
    //  
    // Get list of replicas.  
    //  
  
    // Create the request and add URL parameters.  
    //Uri requestUri = new Uri(clusterUri,  
    //    string.Format("/Nodes/{0}/$/GetApplications/{1}/$/GetReplicas?api-version={2}",  
    //    "Node.2",       // Name of node  
    //    "WordCount",    // Application Name  
    //    "1.0"));        // api-version  
    Uri requestUri = new Uri(clusterUri,  
        string.Format("/Nodes/{0}/$/GetApplications/{1}/$/GetReplicas?api-version={2}",  
        "Node.2",       // Name of node  
        "WordCount",    // Application Name  
        "1.0"));        // api-version  
  
    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(requestUri);  
    request.Method = "GET";  
  
    // Execute the request and obtain the response.  
    try  
    {  
        using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())  
        {  
            using (StreamReader streamReader = new StreamReader(response.GetResponseStream(), true))  
            {  
                // Capture the response string.  
                responseString = streamReader.ReadToEnd();  
            }  
        }  
    }  
    catch (WebException e)  
    {  
        // If there is a web exception, display the error message.  
        Console.WriteLine("Error getting the list of replicas:");  
        Console.WriteLine(e.Message);  
        if (e.InnerException != null)  
            Console.WriteLine(e.InnerException.Message);  
        return false;  
    }  
    catch (Exception e)  
    {  
        // If there is another kind of exception, throw it.  
        throw (e);  
    }  
  
    // Deserialize the response string.  
    JavaScriptSerializer jss = new JavaScriptSerializer();  
    List<DeployedStatefulServiceReplica2> replicas = jss.Deserialize<List<DeployedStatefulServiceReplica2>>(responseString);  
  
    // Verify that at least one replica was found.  
    if (replicas == null || replicas.Count == 0)  
    {  
        Console.WriteLine("Error: Zero replicas found for the application.");  
        return false;  
    }  
  
    //  
    // Report replica health.  
    //  
  
    // Stores the response status code.  
    HttpStatusCode statusCode;  
  
    // Create the request and add URL parameters.  
    requestUri = new Uri(clusterUri, string.Format("/Partitions/{0}/$/GetReplicas/{1}/$/ReportHealth?ServiceKind={2}&api-version={3}",  
        replicas[0].Partitionid,    // Partition Id  
        replicas[0].ReplicaId,      // Replica Id  
        "2",                        // Service kind (1 = stateless, 2 = stateful)  
        "1.0"));                    // api-version  
  
    request = (HttpWebRequest)WebRequest.Create(requestUri);  
    request.ContentType = "text/json";  
    request.Method = "POST";  
  
    // Create the Health Policy.  
    HealthInformation2 healthInformation = new HealthInformation2()  
    {  
        SourceId = "RestClient",  
        Property = "State",  
        HealthState = HealthState.Error,  
        Description = "Sample health state description of replica health.",  
        TimeToLiveInMilliSeconds = "0",  
        SequenceNumber = "0",  
        RemoveWhenExpired = true  
    };  
  
    // Serialize the health policy.  
    string requestBody = jss.Serialize(healthInformation);  
  
    // Create the byte array that will become the request body.  
    byte[] requestBodyBytes = Encoding.UTF8.GetBytes(requestBody);  
    request.ContentLength = requestBodyBytes.Length;  
  
    // Create the request body.  
    try  
    {  
        using (Stream requestStream = request.GetRequestStream())  
        {  
            requestStream.Write(requestBodyBytes, 0, requestBodyBytes.Length);  
            requestStream.Close();  
  
            // Execute the request and obtain the response.  
            using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())  
            {  
                statusCode = response.StatusCode;  
            }  
        }  
    }  
    catch (WebException e)  
    {  
        // If there is a web exception, display the error message.  
        Console.WriteLine("Error reporting replica health:");  
        Console.WriteLine(e.Message);  
        if (e.InnerException != null)  
            Console.WriteLine(e.InnerException.Message);  
        return false;  
    }  
    catch (Exception e)  
    {  
        // If there is another kind of exception, throw it.  
        throw (e);  
    }  
  
    Console.WriteLine("Report Replica Health response status = " + statusCode.ToString());  
    return true;  
}  
  
/* This code produces output similar to the following:  
  
Report Replica Health response status = OK  
*/  
  
```